{ config, lib, pkgs, ... } :
{
/*
⢽⣕⢯⡳⡽⣕⢯⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢵⡫⣞⢵⣫⡳⣝⢵⣫⡳⣝⢮⡳⣝⢎⠆⠂⠀⠀⠠⣓⢝⣎⢗⡝⡮⣳⢹⣪⢳⡹⡸⡱⡱⠣⠫⠪⡓⢝⢎⣗⢝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⡽⣕⢯⡳⡽⣕⢯
⢵⡳⣝⢮⢯⢮⡳⣝⢮⡳⡝⡮⣺⡪⡮⣳⡹⣜⢞⡼⣪⡳⡝⣎⢗⣝⢮⢳⢝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⣝⢮⡳⡵⣝⢮⣳⡣⡯⣺⢕⢯⢎⢧⢃⠁⠀⠀⡐⢜⢵⢕⢗⡝⡮⢮⢳⢕⢇⠣⡊⠔⡄⣅⢅⢅⠌⢂⠪⡨⠹⡱⣝⢮⡣⡯⣪⡳⣝⢎⣗⢝⢮⡳⣹⡪⡧⣫⢮⢳⣹⢪⡳⡝⣎⢗⢽⢜⡵⡝⣎⢧⢯⣪⡳⣝⢼⢕⣝⢮⡣⡯⣪⡳⣕⢗⡵⣝⢮⡺⣪⢮⢳⢕⡗⡧⣫⢮⡳⣝⢞⢮⡳⣝⢞⡮⡯
⡯⣞⢵⡫⣞⢵⢝⣎⢗⡵⡫⣞⢵⡹⡺⣜⢞⣎⢗⣝⢮⢮⡫⡮⡳⡵⣝⢵⡫⡧⣳⢳⢵⢝⢮⡳⡝⡮⡳⣝⢮⡳⣝⢮⡳⣝⢞⢮⡳⡵⣝⢮⡳⡽⣕⢯⡣⡃⠔⠀⠀⠠⡹⣪⡳⡝⣎⢏⢎⢇⢧⢣⢣⢪⡣⡳⡵⣻⣺⣺⣴⡠⢊⠱⡨⡊⢇⢯⡺⣕⣝⢮⡳⣕⢯⡳⣝⢮⢮⡫⡮⡳⣝⢮⡳⣝⢮⡳⡽⣕⢯⢮⡫⣞⢵⡳⡵⣹⣪⡳⣝⢮⢳⣹⣪⡳⡝⣎⣗⢽⢜⢮⡺⣪⡳⣝⢵⢝⢮⡳⡣⡯⡮⣫⡳⣝⢮⡳⣝⢮
⡞⡮⣳⢝⡮⣳⢳⢕⢯⡺⣹⢜⡵⣝⢕⡗⡧⡳⣝⢮⢮⢳⢝⢮⡫⣞⢮⡳⡝⣞⢮⡳⣝⢭⡳⣝⢮⣫⡳⣕⢗⣝⢮⢳⢝⢮⣫⡳⣝⢞⢮⡳⣝⢞⣎⢗⣝⠄⠅⠀⠀⠨⡸⣪⢺⡪⡪⡊⡪⡊⣎⢞⠜⠘⡈⠊⠈⠌⠊⠎⢯⢻⢵⢌⢆⠪⡒⢔⠩⡪⡮⣳⡹⡼⣱⡳⣕⢯⡺⡪⡯⣝⢮⡣⡗⣗⡳⣝⢮⢮⢳⡳⣹⣪⢳⢕⢯⡺⡲⡝⡮⡺⣕⢗⢮⢮⣫⡺⣜⢮⡫⡳⣝⢮⢺⡪⡳⣝⢵⣹⢹⡪⣞⢵⢝⢮⡳⣝⢮⡫
⡽⣹⡪⣗⣝⢮⡳⣝⢵⢝⢮⢳⢕⢗⣝⢎⢯⡺⣪⢮⡳⣝⢵⡳⣝⢮⡣⣗⢽⡪⡧⣫⢮⡳⣝⢎⡧⢧⡳⡳⣝⢮⡳⣝⢽⣱⡣⡯⡮⣫⡳⣝⢮⢳⢕⢯⣪⢊⠄⠀⠀⡐⡱⡳⡕⡕⢔⢜⡴⣳⠣⠁⠀⡀⠠⠐⢀⠂⡁⠨⠀⠅⡙⢎⢞⣜⢜⢬⢳⡰⡙⣜⢮⣫⡺⣪⢮⡳⣹⡹⣪⢞⢮⡺⣹⡪⡞⣎⢗⣝⢵⢝⢮⣪⡳⡽⢵⢝⢮⡫⣞⡝⡮⡳⣝⢮⡲⣝⢎⡧⣫⢽⢜⢮⡳⣹⡹⣜⢵⠵⣝⢞⢮⡳⣝⢵⢝⢮⡳⣝
⣹⡪⣞⢵⢕⣗⢽⢜⡵⣝⢮⡳⣝⢕⢧⣫⡳⡝⣎⢧⡫⡮⣳⡹⡼⣱⢝⢮⡳⣝⢮⡳⣳⡹⣪⡳⣝⢵⢝⢽⢜⣕⢗⡵⡳⡵⡝⣞⢮⡳⣝⢮⡺⣝⢭⡳⣕⠅⡂⠀⡀⢐⢜⢵⢹⢨⣪⣗⠯⡃⢐⠠⠡⡐⡐⡌⡢⢊⢢⢑⢅⢕⡐⢅⢑⠜⢹⢪⢷⢵⡱⠨⣣⢳⢝⣎⢧⢯⢺⣪⢳⢝⡵⣝⢮⢮⡫⡮⡳⡵⣝⢮⡳⣕⢗⢽⣱⡫⡳⣝⢮⡺⣹⣚⢮⡣⡯⣪⡳⣝⢮⢳⡹⣕⣝⢮⡺⣪⡳⣝⢮⢳⢳⡹⣪⡳⣝⢵⡫⣞
⡞⡮⡳⣝⣕⢧⡳⡳⣕⢧⡳⣕⢗⢽⢕⡵⡳⣹⣪⡳⡝⣞⢮⡺⣹⡪⣫⡳⣝⢮⡺⣚⢮⡺⡵⣹⣪⡳⣝⢵⡫⡮⡳⣝⣝⢮⡫⡮⡳⣕⢗⡳⣝⢮⢳⢝⢮⠊⠄⢀⠀⢂⢪⢳⢑⢜⡮⡮⡑⡐⡐⢌⠪⡪⡘⢔⠜⡌⡆⡣⢊⢂⠪⢊⠢⡑⡐⠨⠨⡳⡭⡣⢸⢕⣗⢵⡳⣝⣕⢧⢏⣗⢵⡳⣕⢗⣝⢮⡫⡞⣎⢧⢏⡮⡳⣝⢖⣝⢽⢜⡵⣝⢮⢎⣗⣝⢮⡳⣝⢼⣪⡳⣝⢮⡺⡪⣞⢮⢺⣪⢳⢝⡵⣝⢮⣺⡪⣗⢽⡪
⣝⣝⢽⢜⡼⣪⢮⡳⣕⢗⢽⡸⣝⣕⢗⣝⢮⡳⣕⢵⣫⡺⣪⢞⢵⢝⢮⡺⣪⡳⣝⢮⡳⣝⢮⢳⡪⡞⡮⡳⣝⢮⡫⣞⢼⠵⣝⢮⢯⡺⣕⢯⢮⡳⣝⢵⡫⡊⠌⠀⠀⡐⢜⢕⢜⢝⢮⠣⡂⡢⠪⡘⢌⢂⡪⡢⡱⡸⡰⡡⡕⡜⣌⢢⠡⡂⠪⠨⠨⡪⡞⡎⢜⣕⢗⡵⡽⣜⢼⣪⡳⣕⢗⣝⢮⡳⣕⢗⡽⣹⡪⣳⢝⢮⡫⡮⡳⡵⣝⡕⣗⢵⡳⣝⢖⡵⣳⡹⣪⡳⣕⢽⢜⡵⣝⢝⡼⣪⡳⣕⢏⣗⢽⢜⡵⡵⡝⡮⡳⣝
⢮⢮⢳⢝⢞⢮⡣⣗⢵⡫⡳⣝⢼⢜⡵⡳⡵⡝⡮⡳⣕⣝⢮⡫⡳⣝⢵⢝⢮⡺⣪⢧⣫⡺⣪⡳⣝⢮⡫⣝⢮⡳⣝⢮⡳⣝⢮⡳⡳⣝⢮⡳⣳⡹⣪⡳⡹⡌⢂⠀⠁⠠⢱⡣⡱⡩⣗⢝⠰⡘⢌⢎⢮⣺⣺⢵⡳⣕⢕⢵⣫⢯⢞⣗⣝⢎⡇⡕⠅⡣⡻⡜⣜⢮⢳⢝⢮⢮⡳⣕⢽⢜⡵⡳⡵⣝⢮⡳⣝⢼⣪⡳⣝⢵⢝⢮⡫⣞⢮⢮⢳⡳⣹⡪⡳⣝⢼⣪⡳⣹⠼⣕⢯⡺⡼⢵⢝⢮⡺⣪⡳⣕⢗⣝⢮⢮⡫⣞⣝⢮
⣳⢝⡵⣫⡫⣞⡺⣪⡳⣝⢝⢮⡳⣝⢮⢳⢳⣹⡪⡯⣪⢮⢳⡹⡝⣎⣗⢽⢵⢝⢞⢮⠮⡮⣳⡹⣜⢵⢝⢮⡳⡝⣎⣗⣝⢮⡳⣝⢽⢜⡵⣝⢮⢮⢳⡹⣕⢅⢂⠀⠁⠌⡢⣏⢆⢯⡺⡕⡑⣕⢭⣫⣳⣵⣗⣟⢾⡕⠅⢯⢾⢽⡻⡾⣞⢵⡫⡮⡓⢜⣽⢸⡸⣪⢯⡺⣕⢗⢽⡸⡵⣝⢮⡳⡝⡮⣺⡪⡮⡳⣕⣝⢮⡳⣝⢵⢝⡮⡮⣳⢳⢝⢮⡺⣝⢮⢳⢕⣝⢮⡫⡮⡳⣕⢯⢳⢝⡵⣝⢮⡺⣪⡳⡵⣝⢮⡺⡵⣕⢗
⡳⣝⢞⢮⡺⣪⢞⣕⢗⡵⡫⡧⡳⡵⣝⢵⡫⣲⢝⢮⡳⣹⢵⢝⢮⡳⣪⡳⡳⣝⡝⡮⣫⢞⢮⣺⡪⣗⢽⢵⢝⢮⡳⡵⣕⢗⣝⢮⡳⣝⢞⢮⡳⣝⢵⢝⢮⡂⡂⠀⠂⢁⢜⢜⡎⡎⡾⣕⠭⡪⡳⡕⡗⣝⢮⣫⡳⡍⠄⢑⠽⡕⣏⢯⢺⢘⢜⠘⢌⠪⡪⡣⣫⢮⡣⣗⡳⣝⢵⢝⢮⡺⣪⢮⡫⣞⢵⡹⣪⢯⡺⣜⢮⡺⣪⡳⣝⢞⣺⡪⣳⢝⡵⣝⢮⡺⡭⡳⣕⢗⣝⢮⡫⡮⡳⣝⢵⢝⡼⣕⣝⢮⡺⡺⣜⢵⢝⢞⢮⡳
⢯⢮⡫⡧⣫⢮⡳⣕⢗⡽⣹⡪⡯⡺⡪⡧⣫⢮⡳⡳⣝⢞⣎⢏⡧⢯⡺⣪⢯⢺⡪⡯⢮⣫⢳⢕⣝⢮⢳⡳⣝⢵⢝⡞⡮⣳⢳⡳⣝⢮⣫⡳⣝⢎⣗⢽⢕⠆⡂⠁⡀⠂⡌⣗⢝⡎⡝⡎⡪⢊⢊⢎⢎⢮⠣⢣⠣⡃⣅⢢⡑⢭⠪⡪⡓⡕⡕⡌⢆⠣⡣⡻⡜⣞⡺⣪⢞⢮⡳⣹⢕⣝⢮⡣⡯⣪⡳⣝⢮⡺⣪⢮⡳⣝⢮⡺⣪⡳⡵⣝⢮⡳⡝⣎⢗⣝⢮⡫⡮⡳⣕⢗⣝⢮⡫⡮⡳⣝⢮⡺⣜⢵⢝⢞⢮⡳⣝⡝⣞⢮
⡳⣳⡹⣪⡳⣣⢯⢮⡳⣝⢮⡺⡪⣏⢯⢮⢳⢵⢝⢞⢮⡳⣕⢯⡺⣕⢯⡺⣪⡳⣝⢮⡳⣕⢯⡳⣕⢏⣗⢵⢳⡹⡵⣝⢮⡳⡳⣝⢮⡳⡵⣝⢮⡳⡵⡝⡮⡃⡂⠄⠠⠈⢜⢜⣕⢗⡳⡱⡡⡣⡱⡱⡑⡕⡜⡼⡑⡱⣱⡳⣿⣪⢣⡣⡕⡕⡕⡕⢕⡑⢵⢕⢹⡪⣞⢵⢝⡵⣝⢮⡳⣕⢗⣝⢮⡳⣹⢜⡞⡮⡳⡳⣝⢎⣗⢝⡮⡺⣕⢗⡵⣝⢮⡳⣝⢎⡧⡯⡺⡝⡮⡳⣕⢗⣝⢮⣫⡺⣪⢞⣎⢗⣝⡝⡮⣺⡪⡞⡮⡳
⣝⢮⡺⣕⣝⢮⢮⡳⣕⢗⢧⣫⡫⡮⣳⡹⣕⢗⢽⡹⣕⣝⢎⡧⢯⣪⡳⣝⢮⡺⣪⡳⡝⡮⣳⡹⣪⡳⣕⢏⣗⣝⢞⣎⢗⡽⣹⣪⡳⣝⢞⣎⢗⡵⡳⣝⢞⢌⢐⠀⠐⢈⢌⢗⣕⢧⢱⡣⡪⡊⡎⡮⣪⢺⢪⢣⢣⡳⣜⣞⢗⢕⢅⢇⢧⢣⢣⢣⢣⢊⢎⢙⢔⣝⢮⡳⣝⢮⢮⢳⢕⣗⢝⢮⡳⡝⡮⡳⣝⢮⡫⡳⣕⢯⣪⡳⣝⢽⡸⡵⡝⣎⢧⢯⣪⡳⡵⣝⢮⡫⣞⢽⢜⢵⢳⢕⢧⡫⡮⣣⢗⢽⢜⣎⢯⠮⣎⢯⡺⡝
⢗⡳⣝⣜⢮⢮⢳⢕⣗⢽⡱⡵⢵⢝⢮⢺⡪⣫⡳⡝⡮⣪⡳⣝⣕⢧⡫⡮⡳⣝⢮⡺⣹⢺⢜⢮⡣⡯⣪⡳⣕⢮⡳⣕⢯⢮⡳⣪⢞⢮⡳⣕⢯⢮⡫⣎⢯⠢⠂⠄⠁⡐⢌⢞⣜⢎⡢⢣⠱⡱⡱⡱⡕⡧⣳⠱⣕⢧⢳⣕⢯⣣⢧⡣⡧⡳⡱⡕⡕⡕⡥⣑⡜⣎⢧⡳⡳⣕⢏⣗⢽⢜⡭⡳⣕⢯⡺⣹⢜⡮⡺⣝⢎⡧⡳⣕⢗⡳⣝⢮⡫⡮⣳⣣⡳⣕⢯⣪⡳⡝⡮⢮⡫⡳⣝⢭⡳⣹⣪⢳⢝⢮⢳⢕⢗⣝⢮⡳⡝⡮
⣝⢮⢧⢳⡳⡹⣕⢗⡵⡳⣝⢮⡳⣝⢵⢳⢝⢮⢎⣗⣝⢮⡺⡪⡮⣳⢹⣪⡳⣕⢗⣝⢮⡳⣝⢵⢝⢮⡳⡝⡮⡳⣝⢎⣗⢵⢝⡮⣫⡳⣝⢮⡳⡵⣝⢮⢳⡑⡁⠂⠁⢐⢨⣣⡳⣝⢬⢢⡣⡣⡳⡹⡸⡪⡗⡕⣕⢕⢽⣺⡫⡟⣏⢟⢎⣇⢧⢳⢹⢸⢸⢵⢝⢮⡳⣝⢵⡳⣝⢮⢮⡳⣝⢝⢮⡳⣝⢮⡳⣹⡹⡼⢵⢝⣝⢮⡳⣝⢮⢳⣹⣪⡳⣪⢞⢮⡣⣗⢵⡫⣞⢵⢝⡵⡳⡳⣝⢮⣪⡳⣝⢮⡳⣝⣕⢗⡵⡳⣝⣝
⢼⢵⢝⢵⣹⡹⣜⢵⢝⢞⣎⢧⡫⡮⡳⣝⢮⢳⣣⡳⡪⣇⢯⢝⡞⡼⣕⢧⢳⢳⡹⣜⣕⢧⡳⣝⢵⡳⣝⢮⡫⣞⢮⡳⣕⢯⡳⣝⢮⣺⣪⡳⣝⢮⡺⣪⡳⡅⠌⠄⢁⢐⠰⣕⢕⢧⡫⣣⡳⣹⢘⢈⠊⡁⡢⡣⡳⡕⠟⣞⢮⢯⡪⡎⣞⢼⢸⡪⡎⡧⡙⡮⣫⡳⣝⢮⢳⡹⣜⢮⡳⣹⢼⡹⣕⢗⢵⡳⣝⢮⣺⡹⣕⢯⡺⣪⢞⢮⡳⡽⣜⢖⣝⢮⡫⡞⣞⢮⢳⢝⢮⡳⣝⢮⡫⣞⢮⡣⣗⢽⢜⡞⡮⡺⣜⢵⢝⣞⣜⢮
⡳⡳⣝⣕⢧⡫⡮⡳⣝⢵⢕⡗⣝⢎⢯⢺⡪⡳⣕⣝⢽⢜⡵⡳⡝⡞⣎⢗⡽⣕⣝⢮⡪⡧⣫⢮⢳⢕⣗⡳⣝⢮⢳⡹⣜⣕⢗⡵⡳⡵⣕⣝⢮⡣⡯⡺⡼⢌⢂⠂⠠⠐⡨⡎⣏⢮⢺⡪⡺⣜⢰⠐⠔⡌⢔⢝⢵⢡⠠⡀⢧⢣⢣⢣⣣⢳⢕⢕⢕⢕⢔⢝⢮⡺⣪⡳⣝⢮⡳⡳⣝⢮⡳⣝⢼⢭⡳⣕⢗⢗⡵⡝⡮⣣⢯⢮⢳⡳⡝⡮⡮⡳⣕⢗⣝⢞⢮⡳⣝⣝⢮⡺⣪⢧⡫⡞⡮⣺⣪⡳⡳⣝⢮⡫⡮⣳⢳⢕⢮⡳
⡝⣞⢮⢎⣗⢝⢮⡫⡮⡳⡳⣝⢎⣏⢗⡳⣝⢝⣜⢮⡺⡵⡝⡮⣫⢝⢮⡳⡳⡵⡕⣗⡝⡮⣳⡹⣕⢗⡵⣝⢼⣪⡳⣝⢮⢮⡳⣝⢵⢝⢮⢎⣗⣝⢮⡫⡮⡣⢐⠀⠂⡁⢢⢫⢮⡪⣇⢏⣗⡧⠢⡑⢕⠕⡕⣝⢼⡸⡨⡊⡆⢝⡵⣫⢮⡳⡹⡸⡸⡸⡐⡕⣳⣝⢮⣺⣪⡳⣝⢝⣎⢗⢽⢜⡵⡳⣝⢎⡯⡳⣕⢯⢝⢮⡺⣪⡳⣝⢮⡳⣝⢝⢮⡳⣕⢯⡣⣗⢧⡳⣕⢯⡺⣪⢞⣝⢮⡳⣕⢽⢕⣗⡳⣝⢮⡳⣝⢭⡳⡝
⢯⡺⣪⡳⡕⣏⢗⣝⢮⡫⡳⣕⢯⣪⡳⣝⢮⢳⢕⣗⢝⢮⡳⣝⢮⡫⡧⣫⢞⡵⣝⢮⡺⣹⡪⡞⡮⡳⣕⢗⢧⡳⣹⢜⢮⡳⣹⣪⡳⣝⢗⡽⣜⢮⡺⣪⡳⣑⢐⠈⠠⠐⢡⢣⢇⢧⢳⢵⢯⡇⡣⡊⡆⡏⡞⣎⢧⢳⡱⡕⡕⡅⡟⡮⡣⣏⢞⢜⢎⢎⢗⠅⢘⡮⣗⣗⡷⡽⣝⢷⣳⢯⣳⡣⡯⣺⢪⡳⡝⣝⢮⢳⢝⡵⣝⢮⡺⣪⡳⡝⣎⢯⡣⡯⢮⡳⡝⡮⣺⡪⡮⡳⣝⢮⢳⢕⡗⡽⣜⢵⡳⣕⣝⢮⡣⡯⣪⡳⡝⡮
⡳⣝⢮⢎⢯⣪⡳⣕⢗⣝⡝⡮⣣⡳⣕⢗⣝⢵⢝⡼⡭⡳⣕⢗⡵⣝⢮⡳⡳⣝⢼⢺⣪⢳⢝⢮⡫⡳⣕⣏⢧⠯⡮⣫⡳⣝⢮⢮⡺⣪⢗⣝⢮⡺⣪⡳⣹⡂⡆⡦⣢⢵⡼⣼⣵⣽⣺⢽⡽⡰⣪⡪⣎⢮⣚⢮⢪⡪⡪⡪⡪⡢⣫⡫⡽⡜⣎⢧⢳⢭⢻⠀⠀⣟⡷⣯⢾⣽⣺⣽⣞⣯⢷⢯⢯⣗⡯⣞⣞⢮⢮⡳⣹⡪⡮⡳⣝⢮⢮⡫⡮⡳⣝⢮⡳⣝⢮⡫⣞⢎⢯⡳⡵⣝⢵⣫⡺⣕⢗⡳⣕⢧⡳⣳⡹⣪⡳⣝⢮⡫
⣫⡺⣪⡫⡧⡳⡕⣗⢝⣖⢝⣝⢮⡺⣪⡳⡵⣝⣕⢗⢽⢕⣗⡝⣞⢎⣗⢝⡞⡮⡫⡧⡳⣝⢵⢳⣹⡹⡼⣜⢮⡫⣞⡕⣗⢵⢳⢳⢝⢮⡳⣓⡗⣝⠮⣎⢧⢳⢝⢮⡳⡽⣝⣯⣳⣳⡽⣯⢷⡱⣕⢵⢳⡱⣕⢗⢵⡣⣇⢧⡣⡣⡺⣜⢮⡳⡱⡕⣕⢗⢏⢀⢀⢸⢿⣽⣻⣞⣟⣷⣻⢞⡿⣽⣻⢮⡯⣗⡯⣯⢗⡯⡷⡽⣽⢽⣪⡳⡵⡝⡮⣫⢮⡳⣝⢮⢳⢝⣎⢯⡣⣗⣝⢮⡣⡧⣳⢳⢝⢞⢮⢳⢝⢮⢮⢳⡹⣜⢮⡺
⢕⣝⢮⡺⣪⡳⣝⢮⢳⢕⢯⢎⡧⣫⢞⡺⣪⡺⣜⢭⡳⡳⣕⣝⢮⡳⣕⢯⡺⣹⢕⢯⢝⣎⢗⣝⢖⣝⢮⢮⢳⡹⣜⢞⢮⡫⡳⣝⢭⡳⣝⢮⣺⡪⡯⣺⡪⣏⢯⡳⡽⣝⣞⡮⣾⣺⡽⣯⣿⢸⢜⢮⡳⣹⡪⣝⢵⢝⡼⢵⡹⡪⡪⠨⢳⣻⢕⢝⠎⢏⢔⢕⢅⢪⣟⣾⢯⣟⣯⣷⣟⣯⣯⢷⡯⣯⢿⡽⣽⡽⣯⢿⡽⣯⢿⣽⣳⣝⢮⣫⡺⣕⢗⣝⢮⡺⡭⡳⣕⢗⣝⢮⢎⣗⣝⢮⡳⣝⢮⣫⡳⣝⢵⡫⡮⡳⣝⢮⢳⣹
⡳⣕⢗⣝⢮⡺⣪⡳⣝⢝⢮⡳⣝⢮⡳⣝⢞⡺⣪⡳⣝⢽⢜⣎⢧⡫⡮⣳⡹⡪⡯⡺⣕⢧⢯⣪⡳⣕⢗⣝⢵⢝⢮⡫⡞⡮⣫⢮⡳⣝⣮⣷⢷⣯⣟⣞⣞⡽⡵⣯⢯⣗⣗⡯⣗⣿⣻⣽⡾⡱⡹⣪⡺⣪⡺⡪⡮⣳⢹⢕⢽⢱⢘⢌⠆⡗⡅⡣⡱⡱⡸⡜⡕⣜⡾⣯⡿⣯⣿⣳⣟⣷⢯⡿⣽⢯⢿⡽⣗⣿⡽⣯⣿⣽⢿⣷⣻⡮⡧⣣⡳⡳⣝⢎⣗⢝⢮⡫⡮⡳⣕⢯⡣⣗⢮⡳⣝⢼⢕⡵⡳⣕⣗⣝⢮⣫⡺⣪⡳⡵
⡫⡮⣳⢕⣗⢝⢮⡺⡪⣏⢗⣝⢮⢳⣹⡪⣳⢝⢮⡺⣪⡳⡳⣕⢯⡺⣹⢜⢮⡫⣞⢝⢮⡳⣕⢧⡳⣕⢗⡵⣝⢵⡳⣝⢮⡫⡮⡳⣝⣯⣿⢾⣟⣷⣿⣽⣾⢯⣯⢷⣻⣞⣗⣯⣗⣗⣟⣷⠏⡜⣎⢧⡫⡮⣪⡳⣝⢼⡱⣝⢕⢕⢌⢶⢳⣗⠑⡌⡪⡪⡪⡪⡣⡪⣿⡽⣟⣿⡾⣯⡿⣞⣯⡿⣽⢯⡿⣽⣻⢾⣽⣻⣾⡽⣟⣷⢿⡽⣯⡺⡪⣏⢮⡳⣕⢯⡳⣝⢮⡫⡮⡳⣝⢎⡧⣳⢳⡹⡵⡝⡮⣳⡪⡮⣣⡳⡝⡮⢮⡳
⢝⢮⡳⣝⢼⡹⣕⢽⡹⣪⡳⣕⢯⢳⢕⣝⢮⣫⡳⣝⢞⢮⡫⡮⡳⣝⢮⣫⢳⢝⣎⢯⡳⡝⣎⡗⣝⢮⢳⢝⡼⡕⣗⢵⢳⢝⢮⡫⣯⣿⣾⣿⣿⣿⢿⣻⣿⣿⣿⣟⣷⢯⣷⣿⣾⣷⣷⡫⡸⢜⢮⢺⢜⢞⡜⡮⡪⡎⡮⡪⢪⠪⡸⡨⡲⡳⡑⡜⡜⡌⡪⡸⡨⡪⣿⣽⣟⣯⣿⣟⣿⣻⡷⣟⣯⡿⣽⣗⡿⣽⣞⣷⣯⡿⣿⣟⣿⣻⣷⣫⢝⢮⡳⡝⣎⢧⡳⣕⢗⣝⢮⡫⡮⡳⣝⢮⡳⡝⣎⢯⡺⣪⢮⡳⣣⢯⡺⡹⡵⣹
⣫⡳⡝⣎⡗⣝⢮⡳⣝⢮⡺⣪⡳⣝⢵⣓⢗⣕⢗⡵⣫⡳⣝⢮⡫⡮⣣⢗⢽⢕⢧⡳⣝⢮⡳⣝⢮⡳⣝⢵⢳⢝⢮⡳⣝⢭⡳⣝⣿⡷⣿⣻⣽⢯⣟⡯⣯⢷⣻⣻⣟⣿⣗⣿⣽⣿⠏⢰⢸⡱⡝⣎⢗⡳⡹⡜⣎⢮⣻⡮⡂⢇⠕⢔⢕⢕⠸⠨⡢⡑⢕⠌⡆⢝⣯⣷⣟⣯⣷⡿⣯⣿⣽⡿⣯⣿⣳⣯⢿⣳⣟⣾⢷⣿⣻⣯⣿⣻⡾⣗⡯⡳⣕⢯⢮⢳⢝⡼⡕⣗⡳⣝⢮⡫⡮⣣⢗⣝⢮⢳⡹⣪⢞⡺⣪⢞⢮⣫⡺⣕
⡺⡪⣏⢞⢮⢳⡳⣹⢜⡞⡮⡳⣝⢎⡧⡳⣝⢎⣗⣝⢮⡺⣪⡳⣝⢮⡳⣝⢵⡫⡧⣫⢮⢳⡹⣜⢞⡺⣪⡳⣝⢮⢳⢕⡗⣝⢮⡺⡽⡯⣻⢽⣺⣳⣳⢯⣳⣻⣺⣾⣺⣽⣽⢯⣿⠃⠠⡱⡱⣕⢽⢸⡪⡎⣇⢧⢣⢳⣟⣿⣎⠐⢍⠆⡽⡐⠡⢑⢐⠡⡡⠱⡨⠪⣿⢷⣻⣯⣷⣿⣟⣷⣿⣻⣿⢾⣻⡾⣿⣽⢾⣯⣿⣽⣟⣿⣽⣟⣿⣻⣽⣝⢼⢕⣝⢮⡳⣕⢯⢺⢜⢮⡺⣪⡫⡮⡳⡵⣝⢵⢝⣎⢗⣝⢎⣗⢵⢕⢧⡳
⣝⢝⣎⢯⡺⣕⣝⢮⢳⡹⡪⣏⢮⡳⣹⢺⡪⡳⣕⢮⡳⣹⡪⡞⣎⢧⡫⡮⡳⡝⡞⣎⣗⢽⣪⡳⣝⢮⡳⣝⢼⣪⡳⡳⡝⡮⡳⣝⢽⣽⢯⣫⣞⣾⣾⢿⣿⣻⢿⣽⣟⣿⣽⣿⠃⠀⡐⠸⣕⢧⢳⢕⢵⢱⢕⢵⡹⢸⣿⣯⣿⡎⡐⢕⠼⡐⠡⠀⠄⡁⡂⠅⡊⢜⢽⡿⣯⣷⢿⡷⣿⣻⣾⣟⣿⢿⣻⣟⣿⢾⣻⡷⣿⡾⣿⣟⣯⣿⣯⡿⣗⣷⢝⣕⢗⣕⢗⢵⢝⢮⡫⣣⢯⢺⢜⢵⢝⢮⡺⡪⡧⡳⣕⢗⢵⡣⡯⡺⣕⣝
⢜⡵⡳⡵⣝⢼⢜⢮⢳⣹⡹⣪⡳⡝⡮⣳⡹⣝⢼⠵⣝⢮⢮⡫⡮⡳⣝⢮⡫⣞⢝⢮⡪⡧⡳⣕⢗⢗⢽⢜⡵⡵⣹⡪⡯⣺⡹⡪⡯⣺⡳⣗⣯⡷⣿⣽⢾⢯⣟⢽⡺⡵⣻⠊⢀⢐⠠⠡⠣⡫⣗⣝⢮⡳⣹⡪⡎⣾⢿⡾⣯⣿⡄⠕⡅⡃⠌⡂⠄⠐⠠⢁⢂⠪⡺⣿⣻⣾⢿⣿⣻⣿⣽⣿⣽⣿⡿⣟⣿⣟⣯⣿⣿⡿⣿⣿⣻⣿⡾⣿⢿⣽⢷⡕⣗⢵⢝⢵⢝⢵⡹⣜⢮⢳⡹⣕⢽⡱⡝⡮⣳⡹⣜⡕⣗⢝⣎⢯⣪⢺
⢳⡹⡪⣞⢮⢳⡹⡕⣗⢵⡹⣜⢮⡫⡞⡮⣺⢪⡳⣝⢮⡺⣪⢮⡫⣝⢮⡺⣪⢮⡫⡧⣫⢞⡝⣎⣗⢽⢕⢯⡺⡪⡧⡳⣝⢮⡺⣝⢮⢳⢽⣻⣾⣟⡷⡯⡯⡗⣗⢝⣮⢯⢿⠀⡂⡐⢌⠪⡨⠨⡊⠮⡳⡝⡞⡺⣸⣽⣟⡿⣯⣷⣯⠂⡅⡣⠨⢐⠠⠀⢁⠂⡐⠨⡪⣿⣻⣾⣟⣯⣿⡷⣿⣾⢿⣷⣿⣿⣿⣻⣿⣻⣿⣿⣿⣿⣻⣽⣿⢿⣻⣽⣯⢿⣜⢵⢝⣕⢯⢳⡹⣜⢮⢳⡹⣜⢮⢎⢯⡺⡜⡮⣪⢞⢎⣗⢕⢧⡳⡳
⢯⡪⣏⢞⢮⢳⡹⡪⡮⡣⡯⣪⢧⢳⢝⢞⡎⣗⢝⡼⣕⣝⢮⡣⡯⢮⡳⣹⡪⡞⡮⣺⣪⡳⡝⡮⣺⢪⢏⣞⢮⡫⣞⣝⢮⢳⡹⣜⢮⡫⣯⣷⡿⡾⡯⡯⣫⢞⡮⣟⣾⣻⣟⡐⡐⢌⠢⡑⢌⠪⠨⡊⠔⢅⠕⡐⣟⣾⢷⣻⡿⣾⣻⡇⠄⡇⠨⢐⠨⠀⠠⠀⡐⠨⢢⢻⣿⢾⣻⣽⣷⣿⣿⣻⣿⣿⣽⣿⣽⣿⣟⣿⣿⣿⣯⣿⣿⣿⣻⣿⣟⣿⡾⣟⣮⡳⣕⢗⣝⢵⢝⣜⢮⢳⡹⣜⢎⢯⡺⣪⢳⡹⣪⢳⡣⡳⣝⢵⡹⣪
⢵⢝⣎⢯⡺⣕⡝⡮⡳⣹⡪⡳⣝⣕⢯⢳⡹⣪⡳⣕⢗⢎⡧⡳⣝⢵⢝⢮⢎⡯⡺⣕⢮⢮⡫⣞⢮⡳⣝⢮⡺⣚⢮⡺⣪⢗⣝⢮⡳⣝⣺⣺⣟⡯⡯⣫⢾⢽⡽⣯⣟⣷⣿⣮⢪⠢⡑⢌⠢⡑⡑⡌⡪⠢⡑⣼⣿⣽⡿⣯⣿⢿⣽⣗⠡⡢⢂⠐⠌⡂⠐⢀⠐⠨⡊⣺⣿⣻⣟⣯⣿⣾⣟⣿⣯⣿⣿⣽⣿⣯⣿⣿⣽⣿⣿⣿⣿⣻⣿⣽⣯⣷⣿⢿⡽⣞⡎⡧⡳⡵⣝⢜⢮⡳⡹⣜⢭⢇⢯⡪⡧⡫⣎⢧⡫⡽⡸⣕⢝⢮
⡵⡳⣕⢗⡽⡜⣎⢗⣝⢮⢺⡹⡼⡜⡮⡳⣝⢮⢺⡪⡳⣝⢮⡫⡮⡳⡝⡮⣳⡹⣕⢗⣝⢮⡺⡪⡧⡳⣕⢗⣝⢮⡳⣝⢮⡳⣕⢗⡽⢼⢜⢞⣗⡽⣹⣽⢽⣯⢿⣯⣿⢿⣯⣿⣞⣮⣪⢢⢃⢪⢂⢎⠢⡱⣸⣳⣿⣿⣟⣿⣟⣿⣿⣽⢐⢭⢐⠨⠨⡐⠀⠄⠂⢑⢌⢪⣿⣽⣟⣯⣿⣾⣿⣻⣿⣯⣿⣿⣽⣿⣿⣻⣽⣿⣿⣿⣿⡿⣿⣽⣯⣿⡾⣟⣿⣳⢯⢝⢞⢮⣪⡫⡣⣏⢗⢵⢝⢮⡳⣹⢪⡫⣎⢧⡳⡝⣝⢼⡹⡪
⣝⣝⢮⢳⡳⣹⡪⡳⡕⣗⣝⢮⢳⡹⣪⢯⣪⡳⡳⣹⡹⣜⣕⢧⡫⡮⣫⢞⢮⡺⣪⡳⣕⢗⣝⣝⢮⡫⡮⣳⢕⣗⣝⢮⡳⣹⣪⡳⣝⢵⡫⣫⢞⣞⣽⢾⣻⣽⣿⣟⣿⣿⣿⣿⣿⣷⣗⣗⣝⢔⡕⣜⢜⡮⡳⣽⣿⣽⣿⣟⣿⣟⣷⣿⡂⡗⢄⠕⡡⢂⠅⠀⠂⡂⠆⠕⣯⣿⣽⣟⣯⣷⣿⣿⣻⣽⣿⣿⡿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣟⣯⣿⣽⣿⣳⡿⣽⣪⡳⡣⣇⢯⢝⢼⡱⣫⡺⣕⣝⢮⢳⡹⣜⣕⢧⡫⡮⡳⡭⡫
⢧⡳⣝⢵⢝⢮⡪⡯⣺⢪⢮⡺⣕⣝⢮⡺⡲⡝⡮⡣⣏⢮⡺⡪⣞⢝⢮⢳⢳⡹⣪⡺⣪⡳⡵⣕⢗⣝⢮⡳⣝⢼⡪⡧⣫⢞⢖⣝⢮⡳⡝⡮⣻⣺⣞⣿⣽⢿⣾⣿⡿⣿⣽⣾⣿⣿⢿⣷⣳⣝⢮⢮⢗⡏⣏⣿⣯⣿⣿⣟⣿⣟⣿⣿⡊⡇⡑⡌⠢⠡⢂⠂⢁⠨⡊⢜⢼⣿⢷⡿⣟⣿⣯⣿⣿⣿⣿⣿⣿⣿⣿⣷⣿⡿⣿⣿⣿⣾⣿⣿⣿⣿⢿⣽⣯⣿⣟⡮⣎⢯⢺⢜⢵⢳⡹⣜⠮⡮⣪⢮⢳⡹⡼⣸⡪⣺⡪⡳⡝⡮
⢳⢝⣎⢗⡽⣱⢳⡹⣪⢳⢕⢗⢵⢺⢜⢮⡳⣝⢮⡫⡮⣳⢹⡹⣜⡝⡮⣫⢳⡹⣪⢮⡳⡵⡝⣎⣗⢵⡳⣝⢮⡳⣝⢮⡳⣝⢵⡳⣳⡹⣪⢏⣗⢷⣻⣷⢿⣟⣯⣷⣿⣿⣿⣟⣯⣿⣿⣿⣿⣷⣟⣮⢹⡸⣴⣿⣿⣻⣽⣿⣿⣟⣿⣽⡷⡑⢅⠪⡘⢌⢂⢂⠐⡨⠢⡑⡜⣿⣟⣿⢿⣻⣽⣿⣿⣯⣿⣾⣿⣿⣽⣿⡿⣿⣿⣿⣿⣟⣿⣻⣽⡾⣟⣯⣿⢾⡯⣿⢜⢮⢳⡹⡕⣗⢝⢼⡹⣪⡺⣪⢳⡹⣪⡺⣜⢵⡹⡪⡯⣺
⢵⡳⣕⢯⡺⣪⡳⡝⣎⢗⣝⢝⡎⣗⣝⢕⢧⡳⡵⡝⡮⡮⡳⣝⣜⢮⡫⡮⡳⡝⣎⢧⡳⡳⣝⢮⢎⣗⣝⢮⢳⡹⡼⣕⣝⢮⡳⣝⢮⡺⡵⡝⡮⣟⣿⢿⣿⢿⣿⣿⣿⣻⣷⣿⣿⣿⣿⣿⣻⣿⣿⣿⣿⣿⣿⣿⣽⣿⣿⣿⣿⣻⣿⣟⡯⡸⡨⠨⢂⠕⡔⡐⡐⢌⢊⠢⡑⣿⣟⣿⣟⣿⡿⣿⣿⣟⣿⣿⣟⣿⣿⢿⣿⣿⣿⣿⣿⣿⣿⣿⣯⣿⣯⣟⡾⣯⢿⡯⡯⢮⢳⡹⣚⡎⣏⢧⡫⡮⡺⡪⣇⢯⢮⢺⡪⡣⣏⢗⣝⢮
⢗⣝⢎⡧⢯⡺⣜⣕⢗⣕⢧⡳⣝⢼⡸⡭⡳⣕⢗⣝⢮⡺⡕⡗⡮⡺⣜⢮⢳⡹⡪⣇⢯⡺⣪⢮⡳⣕⢮⡳⣝⢮⡳⣕⢗⡳⣝⢮⢳⣹⢪⢏⣞⢮⣻⣿⣿⣿⣿⣽⣿⣿⣿⢿⣿⣻⣯⣿⣿⣿⣷⣿⣿⣷⣿⣿⣿⢿⣿⣿⣻⣿⣯⣿⡗⢌⠆⠡⠡⠱⡨⡂⠢⠨⡢⢑⢕⢽⡿⣷⢿⣯⣿⣿⣿⣿⣿⣿⡿⣿⣿⣿⣿⣿⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣻⣽⡯⣟⣯⡳⡳⡹⡜⣞⢼⡱⡵⣹⢪⡳⡕⣗⢵⢳⡹⡹⣜⢵⢕⢧
⡳⣕⢯⡺⡵⣝⢼⡸⣕⢵⡣⡳⣕⢧⡳⡝⡞⣎⢧⡳⡕⡧⣫⢮⢳⢝⢮⣪⡳⣹⡹⣜⢵⢝⢮⡣⡯⣪⡳⣝⢼⣚⢮⡺⣕⢯⢮⢳⢝⣎⢗⡽⣜⢮⡪⡿⣿⣾⡿⣿⣿⣽⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣯⣿⣯⣟⢌⢊⠌⢌⢊⠢⡊⠌⢌⢪⢐⢕⢵⣿⣿⢿⣽⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣯⣿⣻⡿⣿⣿⣿⣿⣿⣿⣿⢿⡽⣎⢗⡝⡮⡺⡜⡮⡺⣪⡣⣏⢞⡎⣗⡳⣹⡹⣜⣕⢯⢳
⣞⢮⡳⣝⢮⢮⡣⣏⢮⡣⡯⣝⢼⡪⡮⡳⡝⣎⢧⡳⡝⡞⡮⢮⡳⡝⡮⡲⣝⢮⢺⡪⣳⡹⣕⣝⢮⢳⡹⡼⡕⣗⡳⣝⢮⢳⡹⣕⢯⣪⡳⣝⣜⢮⢮⡳⣕⢇⠫⢹⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣿⣿⣿⣾⣿⣽⡷⡑⠔⡌⡆⡅⠕⢌⠌⡂⡇⡕⢜⢜⣾⣿⣟⣯⣿⣿⣿⣿⣿⣷⣿⣿⣿⣿⡿⣿⣿⣿⣿⣽⡷⣟⣿⣺⡯⣟⣿⣽⣾⣿⡿⣯⡺⡜⣎⢧⡫⣎⢗⡕⡧⡳⡣⣏⢮⢮⣣⡳⡵⢵⡹⣕
*/
  services.greetd.settings.default_session.command = lib.mkIf config.services.greetd.enable (
    let
      sway-launcher = pkgs.writeShellScript "sway-launcher" ''
        GPU_MUX_MODE=$(cat /sys/devices/platform/asus-nb-wmi/gpu_mux_mode 2>/dev/null)

        case "$GPU_MUX_MODE" in
          1)
            INTEL_CARD=$(for card in /dev/dri/card*; do 
              if [ "$(cat /sys/class/drm/$(basename $card)/device/vendor 2>/dev/null)" = "0x8086" ]; then 
                echo $card
                break
              fi
            done)
            WLR_DRM_DEVICES="$INTEL_CARD" exec sway
            ;;
          0)
            exec sway --unsupported-gpu
            ;;
          *)
            exit 0
            ;;
        esac
      '';  
    in
      "${pkgs.tuigreet}/bin/tuigreet --time --cmd ${sway-launcher} --user-menu --user-menu-min-uid 1000"
  );

  services.xserver.videoDrivers = [ "modesetting" "nvidia"];
  hardware.graphics = {
    enable = true;
  };

  hardware.nvidia = {
    modesetting.enable = true;
    powerManagement.enable = true;
    powerManagement.finegrained = true;
    open = true;
    nvidiaSettings = true;
    package = config.boot.kernelPackages.nvidiaPackages.stable;

    prime = {
      offload.enable = true;
      offload.enableOffloadCmd = true;

      nvidiaBusId = "PCI:1@0:0:0";
      intelBusId = "PCI:0@0:2:0";
    };
  };
  environment.systemPackages = with pkgs; [
    (writeShellScriptBin "nvidia-offload" ''
      export __NV_PRIME_RENDER_OFFLOAD=1
      export __NV_PRIME_RENDER_OFFLOAD_PROVIDER=NVIDIA-G0
      export __GLX_VENDOR_LIBRARY_NAME=nvidia
      export __VK_LAYER_NV_optimus=NVIDIA_only
      exec "$@"
    '')
  ];

}
